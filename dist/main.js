"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var s=[],i=!0,r=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(i=(o=l.next()).done)&&(s.push(o.value),!t||s.length!==t);i=!0);}catch(e){r=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}return s}function _arrayWithHoles(e){if(Array.isArray(e))return e}var reelStoryNav=document.querySelector(".reel-story__nav"),topNavList=document.querySelector(".top-nav__list"),searchbar=document.querySelector(".searchbar"),topNav=document.querySelector(".top-nav"),_document$querySelect=document.querySelectorAll(".js-hamburger-menu"),_document$querySelect2=_slicedToArray(_document$querySelect,2),hamburgerMenu=_document$querySelect2[0],hamburgerMenu2=_document$querySelect2[1],userIcon=document.querySelector(".js-icon-user"),jsModals=document.querySelector(".js-modals"),tabSwitches=document.querySelector(".tab-switches"),newsletter=document.querySelector(".newsletter"),login=document.querySelector(".js-login"),scrollButton=document.getElementById("js-scroll-button");function updateAriaCheckbox(e){e.target.classList.contains("checkbox")&&("true"===e.target.getAttribute("aria-checked")?e.target.setAttribute("aria-checked","false"):e.target.setAttribute("aria-checked","true"))}function updateAriaExpanded(e,t){e.target.hasAttribute("aria-expanded")?"false"===e.target.getAttribute("aria-expanded")?e.target.setAttribute("aria-expanded","true"):e.target.setAttribute("aria-expanded","false"):t.querySelector('[aria-expanded="true"]').setAttribute("aria-expanded","false")}var dropdown=function(){var e,t=!1;return{toggle:function(s){s.target.classList.contains("top-nav__toggle-btn")&&(updateAriaExpanded(s),s.target.closest(".top-nav__item").querySelector(".dropdown").classList.toggle("dropdown--is-visible"),e=topNavList.querySelector(".dropdown--is-visible"),t||searchbar.classList.toggle("searchbar--is-delineated"))},focusOut:function(s){e&&!e.parentElement.contains(s.target)&&(updateAriaExpanded(s,topNavList),e.classList.remove("dropdown--is-visible"),t||searchbar.classList.toggle("searchbar--is-delineated"))},delineate:function(){t=!0!==t,e||searchbar.classList.toggle("searchbar--is-delineated")}}}(),scrollToTop=function(){var e=document.querySelector(".l-flag h1");return function(){window.scroll({top:0}),e.focus()}}(),deployScrollNav=function(){var e=document.querySelector(".navbar-mobile"),t=document.getElementById("js-scroll-top"),s=document.querySelector('input[name="emailAddress"]'),i=document.querySelector(".l-navbar-scroll"),r=window.innerHeight||document.documentElement.clientHeight;return function(){var a=s.getBoundingClientRect().top;(a>0&&a<=r&&(i.classList.add("l-navbar-scroll--is-visible"),e.classList.add("navbar-mobile--is-visible"),i.setAttribute("aria-hidden","false")),i.classList.contains("l-navbar-scroll--is-visible"))&&(t.getBoundingClientRect().top>0&&(i.classList.remove("l-navbar-scroll--is-visible"),e.classList.remove("navbar-mobile--is-visible"),i.setAttribute("aria-hidden","true")))}}(),modal=function(){var e,t=Array.from(tabSwitches.querySelectorAll("button")),s=_slicedToArray(tabSwitches.querySelectorAll(".js-tab-switch"),2),i=s[0],r=s[1],a=jsModals.querySelector(".js-modal-menu"),o=jsModals.querySelector(".js-modal-form"),l=document.querySelector(".js-icon-close-kinja"),c=document.querySelector("body"),n=!1;function d(s){var i,r;e=document.activeElement,a.classList.contains("l-modal--is-visible")?i=Array.from(a.querySelectorAll('a[href], button, textarea, input[type="text"], input[type="radio"], input[type="checkbox"], select')):o.classList.contains("l-modal--is-visible")&&(i=Array.from(o.querySelectorAll('a[href], button, textarea, input[type="text"], input[type="radio"], input[type="checkbox"], select')));var l=(r=tabSwitches.classList.contains("tab-switches--is-visible")?t.concat(i):i)[0],c=r[r.length-1];n||setTimeout(function(){l.focus()},100),n=!0,s.addEventListener("keydown",function(e){"Tab"===e.key&&(e.shiftKey?document.activeElement===l&&(c.focus(),e.preventDefault()):document.activeElement===c&&(l.focus(),e.preventDefault()))})}return{trapFocus:d,displayMenu:function(){c.classList.toggle("no-scroll"),a.classList.toggle("l-modal--is-visible"),tabSwitches.classList.add("tab-switches--is-visible"),l.classList.add("icon-close--is-hidden"),d(jsModals)},displayForm:function(){c.classList.contains("no-scroll")||c.classList.add("no-scroll"),o.classList.add("l-modal--is-visible"),d(o)},switch:function(e){if(e.target.classList.contains("tab-switches__item")){if(!e.target.classList.contains("tab-switches__item--is-active")){var t=tabSwitches.querySelector(".tab-switches__item--is-active");t.classList.remove("tab-switches__item--is-active"),t.setAttribute("aria-pressed","false"),e.target.classList.add("tab-switches__item--is-active"),e.target.setAttribute("aria-pressed","true"),a.classList.toggle("l-modal--is-visible"),o.classList.toggle("l-modal--is-visible"),o.classList.toggle("l-modal--top-offset")}d(jsModals)}},close:function(){document.querySelector(".l-modal--is-visible").classList.remove("l-modal--is-visible"),tabSwitches.classList.remove("tab-switches--is-visible"),l.classList.remove("icon-close--is-hidden"),c.classList.remove("no-scroll"),i.classList.contains("tab-switches__item--is-active")||(i.classList.add("tab-switches__item--is-active"),i.setAttribute("aria-pressed","true"),r.classList.remove("tab-switches__item--is-active"),r.setAttribute("aria-pressed","false"),o.classList.remove("l-modal--top-offset")),n=!1,e.focus()}}}();function stopSubmission(e){e.preventDefault()}function validateField(e,t,s){!e.value&&t.classList.contains("hide")?(t.classList.remove("hide"),e.setAttribute("aria-invalid","true"),e.setAttribute("aria-describedby",s),e.focus()):e.value&&!t.classList.contains("hide")&&(t.classList.add("hide"),e.setAttribute("aria-invalid","false"),e.removeAttribute("aria-describedby"))}var validateForm=function(){var e=document.getElementById("username"),t=document.getElementById("js-username-error"),s=document.getElementById("key"),i=document.getElementById("js-key-error");return function(r){validateField(e,t,"js-username-error"),validateField(s,i,"js-key-error"),r.preventDefault()}}(),toggleSearchBar=function(){var e=searchbar.querySelector(".js-searchbar-svg"),t=e.querySelector("use");return function(s){if(s.target.classList.contains("js-searchbar-toggler")){e.classList.contains("icon-search")?(e.classList.remove("icon-search"),e.classList.add("icon-close","icon-close--sm","icon-close--grey"),t.setAttribute("href","#icon-close")):(e.classList.remove("icon-close","icon-close--sm","icon-close--grey"),e.classList.add("icon-search"),t.setAttribute("href","#icon-search")),searchbar.classList.toggle("searchbar--is-expanded"),updateAriaExpanded(s),topNavList.classList.toggle("top-nav__list--is-hidden");var i=topNav.querySelector(".dropdown--is-visible");i&&i.classList.remove("dropdown--is-visible")}}}(),reelTransition=function(){var e,t,s,i,r,a,o,l,c,n,d=document.querySelector(".js-reel-articles"),u=document.querySelectorAll(".reel-story__thumbnail-item"),v=document.querySelectorAll(".reel-story"),m=document.querySelectorAll(".j-progress-bar__fill"),b=5e3,y=0;function h(){if(r=b,i=Date.now(),e&&(e.classList.remove("reel-story__thumbnail-item--is-active"),t.classList.remove("reel-story--is-active"),e===u[u.length-1]))for(var a=0;a<m.length;a+=1)m[a].classList.remove("j-progress-bar__fill--is-active"),m[a].offsetWidth;u[y].classList.add("reel-story__thumbnail-item--is-active"),v[y].classList.add("reel-story--is-active"),m[y].classList.add("j-progress-bar__fill--is-active"),e=u[y],t=v[y],n=m[y],y===u.length-1?y=0:y+=1,s=setTimeout(h,b)}return{hoverIn:function(e){n.classList.add("j-progress-bar__fill--is-paused"),s&&window.clearTimeout(s),r-=Date.now()-i,a=reelStoryNav.querySelector(".reel-story__thumbnail-item--is-active"),o=d.querySelector(".reel-story--is-active"),a.classList.remove("reel-story__thumbnail-item--is-active"),o.classList.remove("reel-story--is-active");var t=(l=e.target.parentElement).querySelector("img").getAttribute("alt");c=d.querySelector('img[alt="'.concat(t,'"]')).closest(".reel-story"),l.classList.add("reel-story__thumbnail-item--is-active"),c.classList.add("reel-story--is-active")},hoverOut:function(){n.classList.remove("j-progress-bar__fill--is-paused"),i=Date.now(),l.classList.remove("reel-story__thumbnail-item--is-active"),c.classList.remove("reel-story--is-active"),a.classList.add("reel-story__thumbnail-item--is-active"),o.classList.add("reel-story--is-active"),s=setTimeout(h,r)},auto:h}}();function throttle(e,t){var s=!1;return function(){s||(e.call(),s=!0,setTimeout(function(){s=!1},t))}}var deployScrollNavThrottled=throttle(deployScrollNav,120);topNav.querySelector(".top-nav__item:first-child").addEventListener("mouseover",dropdown.delineate),topNav.querySelector(".top-nav__item:first-child").addEventListener("mouseout",dropdown.delineate),topNavList.addEventListener("focusin",dropdown.focusOut),hamburgerMenu.addEventListener("click",modal.displayMenu),hamburgerMenu2.addEventListener("click",modal.displayMenu),topNav.addEventListener("click",dropdown.toggle),searchbar.addEventListener("click",toggleSearchBar),newsletter.addEventListener("click",updateAriaCheckbox),userIcon.addEventListener("click",modal.displayForm),jsModals.addEventListener("click",function(e){e.target.classList.contains("js-icon-close")&&modal.close(e)}),jsModals.addEventListener("keydown",function(e){"Escape"===e.key&&modal.close()}),tabSwitches.addEventListener("click",modal.switch),reelStoryNav.addEventListener("mouseover",reelTransition.hoverIn),reelStoryNav.addEventListener("mouseout",reelTransition.hoverOut),login.addEventListener("submit",validateForm),window.addEventListener("scroll",deployScrollNavThrottled),scrollButton.addEventListener("click",scrollToTop),document.addEventListener("submit",stopSubmission),window.onload=reelTransition.auto();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiX3NsaWNlZFRvQXJyYXkiLCJhcnIiLCJpIiwiX2FycmF5V2l0aEhvbGVzIiwiX2l0ZXJhYmxlVG9BcnJheUxpbWl0IiwiX25vbkl0ZXJhYmxlUmVzdCIsIlR5cGVFcnJvciIsIl9hcnIiLCJfbiIsIl9kIiwiX2UiLCJ1bmRlZmluZWQiLCJfcyIsIl9pIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJuZXh0IiwiZG9uZSIsInB1c2giLCJ2YWx1ZSIsImxlbmd0aCIsImVyciIsIkFycmF5IiwiaXNBcnJheSIsInJlZWxTdG9yeU5hdiIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInRvcE5hdkxpc3QiLCJzZWFyY2hiYXIiLCJ0b3BOYXYiLCJfZG9jdW1lbnQkcXVlcnlTZWxlY3QiLCJxdWVyeVNlbGVjdG9yQWxsIiwiX2RvY3VtZW50JHF1ZXJ5U2VsZWN0MiIsImhhbWJ1cmdlck1lbnUiLCJoYW1idXJnZXJNZW51MiIsInVzZXJJY29uIiwianNNb2RhbHMiLCJ0YWJTd2l0Y2hlcyIsIm5ld3NsZXR0ZXIiLCJsb2dpbiIsInNjcm9sbEJ1dHRvbiIsImdldEVsZW1lbnRCeUlkIiwidXBkYXRlQXJpYUNoZWNrYm94IiwiZSIsInRhcmdldCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiZ2V0QXR0cmlidXRlIiwic2V0QXR0cmlidXRlIiwidXBkYXRlQXJpYUV4cGFuZGVkIiwicGFyZW50Q29udGFpbmVyIiwiaGFzQXR0cmlidXRlIiwiZHJvcGRvd24iLCJvcGVuZWREcm9wZG93biIsImRyb3Bkb3duUGFyZW50SXNIb3ZlcmVkIiwidG9nZ2xlIiwiY2xvc2VzdCIsImZvY3VzT3V0IiwicGFyZW50RWxlbWVudCIsInJlbW92ZSIsImRlbGluZWF0ZSIsInNjcm9sbFRvVG9wIiwibEZsYWciLCJ3aW5kb3ciLCJzY3JvbGwiLCJ0b3AiLCJmb2N1cyIsImRlcGxveVNjcm9sbE5hdiIsImxMb2dvRml4ZWQiLCJzY3JvbGxUb3BCb3VuZGFyeUFic29sdXRlIiwic2Nyb2xsQm90dG9tQm91bmRhcnlBYnNvbHV0ZSIsIm5hdmJhclNjcm9sbCIsInZoIiwiaW5uZXJIZWlnaHQiLCJkb2N1bWVudEVsZW1lbnQiLCJjbGllbnRIZWlnaHQiLCJzY3JvbGxCb3R0b21Cb3VuZGFyeXJSZWxhdGl2ZSIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImFkZCIsIm1vZGFsIiwicHJldmlvdXNBY3RpdmVFbCIsInRhYlN3aXRjaEJ1dHRvbnMiLCJmcm9tIiwiX3RhYlN3aXRjaGVzJHF1ZXJ5U2VsMiIsImhvbWVTd2l0Y2giLCJ1c2VyU3dpdGNoIiwianNNb2RhbE1lbnUiLCJqc01vZGFsRm9ybSIsImtpbmphQ2xvc2VJY29uIiwiYm9keSIsIm1vZGFsRmlyc3RGb2N1c2VkIiwibW9kYWxUcmFwRm9jdXMiLCJtb2RhbEVsIiwibW9kYWxGb2N1c2FibGVFbHMiLCJmb2N1c2FibGVFbHMiLCJhY3RpdmVFbGVtZW50IiwiZmlyc3RGb2N1c2FibGVFbCIsImNvbmNhdCIsImxhc3RGb2N1c2FibGVFbCIsInNldFRpbWVvdXQiLCJhZGRFdmVudExpc3RlbmVyIiwia2V5Iiwic2hpZnRLZXkiLCJwcmV2ZW50RGVmYXVsdCIsInRyYXBGb2N1cyIsImRpc3BsYXlNZW51IiwiZGlzcGxheUZvcm0iLCJzd2l0Y2giLCJhY3RpdmVUYWIiLCJjbG9zZSIsInN0b3BTdWJtaXNzaW9uIiwidmFsaWRhdGVGaWVsZCIsImlucHV0IiwibWVzc2FnZSIsIndhcm5pbmdJZCIsInJlbW92ZUF0dHJpYnV0ZSIsInZhbGlkYXRlRm9ybSIsInVzZXJOYW1lIiwidXNlck5hbWVFcnJvciIsImtleUVycm9yIiwidG9nZ2xlU2VhcmNoQmFyIiwic3ZnVG9nZ2xlciIsInN2Z1VzZSIsImRyb3Bkb3duQ29udGFpbmVyIiwicmVlbFRyYW5zaXRpb24iLCJwcmV2aW91c0FjdGl2ZVRodW1ibmFpbCIsInByZXZpb3VzQWN0aXZlQXJ0aWNsZSIsInRpbWVvdXQiLCJzdGFydCIsInJlbWFpbmluZyIsImZvcm1lckFjdGl2ZVRodW1iIiwiZm9ybWVyQWN0aXZlQXJ0aWNsZSIsImN1cnJlbnRUaHVtYm5haWxMaSIsImN1cnJlbnRBcnRpY2xlIiwidGlja2luZ1Byb2dyZXNzRmlsbCIsInJlZWxBcnRpY2xlcyIsInRodW1ibmFpbHMiLCJyZWVsU3RvcmllcyIsInByb2dyZXNzQmFyRmlsbHMiLCJkZWxheSIsImN1cnJlbnQiLCJhdXRvUmVlbCIsIkRhdGUiLCJub3ciLCJvZmZzZXRXaWR0aCIsImhvdmVySW4iLCJjbGVhclRpbWVvdXQiLCJjdXJyZW50VGh1bWJuYWlsQWx0IiwiaG92ZXJPdXQiLCJhdXRvIiwidGhyb3R0bGUiLCJjYWxsYmFjayIsImxpbWl0IiwidGljayIsImNhbGwiLCJkZXBsb3lTY3JvbGxOYXZUaHJvdHRsZWQiLCJvbmxvYWQiXSwibWFwcGluZ3MiOiJBQUFBLGFBRUEsU0FBU0EsZUFBZUMsRUFBS0MsR0FBSyxPQUFPQyxnQkFBZ0JGLElBQVFHLHNCQUFzQkgsRUFBS0MsSUFBTUcsbUJBRWxHLFNBQVNBLG1CQUFxQixNQUFNLElBQUlDLFVBQVUsd0RBRWxELFNBQVNGLHNCQUFzQkgsRUFBS0MsR0FBSyxJQUFJSyxFQUFPLEdBQVFDLEdBQUssRUFBVUMsR0FBSyxFQUFXQyxPQUFLQyxFQUFXLElBQU0sSUFBSyxJQUFpQ0MsRUFBN0JDLEVBQUtaLEVBQUlhLE9BQU9DLGNBQW1CUCxHQUFNSSxFQUFLQyxFQUFHRyxRQUFRQyxRQUFvQlYsRUFBS1csS0FBS04sRUFBR08sUUFBWWpCLEdBQUtLLEVBQUthLFNBQVdsQixHQUEzRE0sR0FBSyxJQUFvRSxNQUFPYSxHQUFPWixHQUFLLEVBQU1DLEVBQUtXLEVBQU8sUUFBVSxJQUFXYixHQUFzQixNQUFoQkssRUFBVyxRQUFXQSxFQUFXLFNBQU8sUUFBVSxHQUFJSixFQUFJLE1BQU1DLEdBQVEsT0FBT0gsRUFFbFosU0FBU0osZ0JBQWdCRixHQUFPLEdBQUlxQixNQUFNQyxRQUFRdEIsR0FBTSxPQUFPQSxFQVAvRCxJQUFNdUIsYUFBZUMsU0FBU0Ms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SWRQLFNBQVNnRSxpQkFBaUIsVUFBVyxTQUFDekQsR0FDdEIsV0FBVkEsRUFBRTBELEtBQ0p0QixNQUFNOEIsVUFLVnhFLFlBQVkrRCxpQkFBaUIsUUFBU3JCLE1BQU00QixRQUc1Q25GLGFBQWE0RSxpQkFBaUIsWUFBYXdCLGVBQWVxQixTQUMxRHpILGFBQWE0RSxpQkFBaUIsV0FBWXdCLGVBQWV3QixVQUd6RDdHLE1BQU02RCxpQkFBaUIsU0FBVWdCLGNBR2pDckQsT0FBT3FDLGlCQUFpQixTQUFVdUQsMEJBR2xDbkgsYUFBYTRELGlCQUFpQixRQUFTdkMsYUFHdkNwQyxTQUFTMkUsaUJBQWlCLFNBQVVVLGdCQUdwQy9DLE9BQU82RixPQUFTaEMsZUFBZXlCIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbml0IERPTSBlbGVtZW50cyBmb3IgZXZlbnQgbGlzdGVuZXJzXG5jb25zdCByZWVsU3RvcnlOYXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmVlbC1zdG9yeV9fbmF2Jyk7XG5jb25zdCB0b3BOYXZMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRvcC1uYXZfX2xpc3QnKTtcbmNvbnN0IHNlYXJjaGJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWFyY2hiYXInKTtcbmNvbnN0IHRvcE5hdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50b3AtbmF2Jyk7XG5jb25zdCBbaGFtYnVyZ2VyTWVudSwgaGFtYnVyZ2VyTWVudTJdID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcbiAgJy5qcy1oYW1idXJnZXItbWVudScsXG4pO1xuY29uc3QgdXNlckljb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtaWNvbi11c2VyJyk7XG5jb25zdCBqc01vZGFscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1tb2RhbHMnKTtcbmNvbnN0IHRhYlN3aXRjaGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRhYi1zd2l0Y2hlcycpO1xuY29uc3QgbmV3c2xldHRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uZXdzbGV0dGVyJyk7XG5jb25zdCBsb2dpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1sb2dpbicpO1xuY29uc3Qgc2Nyb2xsQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pzLXNjcm9sbC1idXR0b24nKTtcblxuLy8gRlVOQ1RJT05TIC8vXG5cbmZ1bmN0aW9uIHVwZGF0ZUFyaWFDaGVja2JveChlKSB7XG4gIC8vIHRvZ2dsZSBhcmlhLWNoZWNrZWQgc3RhdGVcbiAgaWYgKCFlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NoZWNrYm94JykpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnYXJpYS1jaGVja2VkJykgPT09ICd0cnVlJykge1xuICAgIGUudGFyZ2V0LnNldEF0dHJpYnV0ZSgnYXJpYS1jaGVja2VkJywgJ2ZhbHNlJyk7XG4gIH0gZWxzZSB7XG4gICAgZS50YXJnZXQuc2V0QXR0cmlidXRlKCdhcmlhLWNoZWNrZWQnLCAndHJ1ZScpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZUFyaWFFeHBhbmRlZChlLCBwYXJlbnRDb250YWluZXIpIHtcbiAgaWYgKCFlLnRhcmdldC5oYXNBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnKSkge1xuICAgIGNvbnN0IGFyaWFFeHBhbmRlZEVsID0gcGFyZW50Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ1thcmlhLWV4cGFuZGVkPVwidHJ1ZVwiXScpO1xuICAgIGFyaWFFeHBhbmRlZEVsLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsICdmYWxzZScpO1xuICAgIHJldHVybjtcbiAgfVxuICBpZiAoZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJykgPT09ICdmYWxzZScpIHtcbiAgICBlLnRhcmdldC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAndHJ1ZScpO1xuICB9IGVsc2Uge1xuICAgIGUudGFyZ2V0LnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsICdmYWxzZScpO1xuICB9XG59XG5cbmNvbnN0IGRyb3Bkb3duID0gKGZ1bmN0aW9uIGRyb3Bkb3duU2NvcGUoKSB7XG4gIGxldCBvcGVuZWREcm9wZG93bjtcbiAgbGV0IGRyb3Bkb3duUGFyZW50SXNIb3ZlcmVkID0gZmFsc2U7XG5cbiAgZnVuY3Rpb24gdG9nZ2xlRHJvcGRvd24oZSkge1xuICAgIC8vIG9ubHkgYWN0IG9uIGJ0blxuICAgIGlmICghZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCd0b3AtbmF2X190b2dnbGUtYnRuJykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gaWYgdGhlcmUgaXMgYW4gb3BlbiBkcm9wZG93biBhbHJlYWR5LCBjbG9zZSBpdCBhbmQgdXBkYXRlQXJpYUV4cGFuZGVkXG4gICAgLy8gdG9nZ2xlIGFyaWEtZXhwYW5kZWRcbiAgICB1cGRhdGVBcmlhRXhwYW5kZWQoZSk7XG4gICAgLy8gdG9nZ2xlIGRyb3Bkb3duIGRpc3BsYXlcbiAgICBjb25zdCB0b3BOYXZJdGVtID0gZS50YXJnZXQuY2xvc2VzdCgnLnRvcC1uYXZfX2l0ZW0nKTtcbiAgICBjb25zdCBkcm9wZG93bkNvbnRhaW5lciA9IHRvcE5hdkl0ZW0ucXVlcnlTZWxlY3RvcignLmRyb3Bkb3duJyk7XG4gICAgZHJvcGRvd25Db250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnZHJvcGRvd24tLWlzLXZpc2libGUnKTtcbiAgICAvLyBjaGVjayBpZiBkcm9wZG93biBpcyBvcGVuIGFuZCBzdG9yZSBpbiAgdmFyaWFibGVcbiAgICBvcGVuZWREcm9wZG93biA9IHRvcE5hdkxpc3QucXVlcnlTZWxlY3RvcignLmRyb3Bkb3duLS1pcy12aXNpYmxlJyk7XG4gICAgLy8gZGVsaW5lYXRlIHNlYXJjaGJhclxuICAgIC8vIGlmIG1vdXNlIGlzIG5vdCBob3ZlcmluZyBvdmVyIGl0ZW0gKGkuZS4gaWYgZG93biB2aWEgZm9jdXMpLCB0b2dnbGUgZGVsaW5lYXRpb25cbiAgICBpZiAoIWRyb3Bkb3duUGFyZW50SXNIb3ZlcmVkKSB7XG4gICAgICBzZWFyY2hiYXIuY2xhc3NMaXN0LnRvZ2dsZSgnc2VhcmNoYmFyLS1pcy1kZWxpbmVhdGVkJyk7XG4gICAgfVxuICB9XG4gIC8vIHJlbW92ZSBkcm9wZG93biB3aGVuIHRhYiBmb2N1cyBpcyBvdXRzaWRlIG9mIGl0XG4gIGZ1bmN0aW9uIGZvY3VzT3V0RHJvcGRvd24oZSkge1xuICAgIGlmICghb3BlbmVkRHJvcGRvd24gfHwgb3BlbmVkRHJvcGRvd24ucGFyZW50RWxlbWVudC5jb250YWlucyhlLnRhcmdldCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gaWYgZHJvcGRvd24gaXMgdmlzaWJsZSBhbmQgZS50YXJnZXQgaXMgbm90IHdpdGhpblxuICAgIC8vIHRoZSBlbGVtZW50IGNvbnRhaW5pbmcgdGhlIGRyb3Bkb3duIChhbmQsIGJ5IGV4dGVuc2lvbiwgdGhlIGRyb3Bkb3duIG1lbnUpXG4gICAgdXBkYXRlQXJpYUV4cGFuZGVkKGUsIHRvcE5hdkxpc3QpO1xuICAgIC8vIHRvZ2dsZSBkcm9wZG93biBkaXNwbGF5XG4gICAgb3BlbmVkRHJvcGRvd24uY2xhc3NMaXN0LnJlbW92ZSgnZHJvcGRvd24tLWlzLXZpc2libGUnKTtcbiAgICBpZiAoIWRyb3Bkb3duUGFyZW50SXNIb3ZlcmVkKSB7XG4gICAgICBzZWFyY2hiYXIuY2xhc3NMaXN0LnRvZ2dsZSgnc2VhcmNoYmFyLS1pcy1kZWxpbmVhdGVkJyk7XG4gICAgfVxuICB9XG4gIC8vIGFkZCBib3JkZXIgdG8gc2VhcmNoYmFyXG4gIGZ1bmN0aW9uIGRlbGluZWF0ZVNlYXJjaGJhcigpIHtcbiAgICAvLyBlbmdhZ2Ugb24gcHJlc3MgaWYgbm90IGFscmVhZHkgZW5nYWdlZCB2aWEgaG92ZXI7IGRpc2VuZ2FnZSBvbiBwcmVzcyBpZiBub3QgaG92ZXJlZDtcbiAgICBpZiAoZHJvcGRvd25QYXJlbnRJc0hvdmVyZWQgPT09IHRydWUpIHtcbiAgICAgIGRyb3Bkb3duUGFyZW50SXNIb3ZlcmVkID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRyb3Bkb3duUGFyZW50SXNIb3ZlcmVkID0gdHJ1ZTtcbiAgICB9XG4gICAgLy8gdG9nZ2xlIG9uIGhvdmVyIG91dCBpZiBkcm9wZG93biBub3QgZGlzcGxheWVkXG4gICAgaWYgKCFvcGVuZWREcm9wZG93bikge1xuICAgICAgLy8gaWYgYnV0dG9uIGlzbid0IHByZXNzZWQgKGkuZS4gaWYgZHJvcGRvd24gbWVudSBpc24ndCB2aXNpYmxlXG4gICAgICBzZWFyY2hiYXIuY2xhc3NMaXN0LnRvZ2dsZSgnc2VhcmNoYmFyLS1pcy1kZWxpbmVhdGVkJyk7XG4gICAgfVxuICB9XG4gIHJldHVybiB7XG4gICAgdG9nZ2xlOiB0b2dnbGVEcm9wZG93bixcbiAgICBmb2N1c091dDogZm9jdXNPdXREcm9wZG93bixcbiAgICBkZWxpbmVhdGU6IGRlbGluZWF0ZVNlYXJjaGJhcixcbiAgfTtcbn0oKSk7XG5cbmNvbnN0IHNjcm9sbFRvVG9wID0gKGZ1bmN0aW9uIHNjcm9sbFRvVG9wU2NvcGUoKSB7XG4gIGNvbnN0IGxGbGFnID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmwtZmxhZyBoMScpO1xuICByZXR1cm4gKCkgPT4ge1xuICAgIC8vIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wID0gMDtcbiAgICAvLyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID0gMDtcbiAgICB3aW5kb3cuc2Nyb2xsKHtcbiAgICAgIHRvcDogMCxcbiAgICB9KTtcbiAgICAvLyB0ZWxsIHNjcmVlbiByZWFkZXIgd2hlcmUgd2UgY3VycmVudGx5IGFyZVxuICAgIGxGbGFnLmZvY3VzKCk7XG4gIH07XG59KCkpO1xuXG5jb25zdCBkZXBsb3lTY3JvbGxOYXYgPSAoZnVuY3Rpb24gZGVwbG95U2Nyb2xsTmF2U2NvcGUoKSB7XG4gIGNvbnN0IGxMb2dvRml4ZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmF2YmFyLW1vYmlsZScpO1xuICBjb25zdCBzY3JvbGxUb3BCb3VuZGFyeUFic29sdXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pzLXNjcm9sbC10b3AnKTtcbiAgY29uc3Qgc2Nyb2xsQm90dG9tQm91bmRhcnlBYnNvbHV0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgJ2lucHV0W25hbWU9XCJlbWFpbEFkZHJlc3NcIl0nLFxuICApO1xuICBjb25zdCBuYXZiYXJTY3JvbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubC1uYXZiYXItc2Nyb2xsJyk7XG4gIGNvbnN0IHZoID0gd2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7XG4gIC8vIHZhbHVlIHdpbGwgYWx3YXlzIGJlIHRoZSBzYW1lOyBwaXBlZCB0byBzdXBwb3J0IGRpZmZlcmVudCBicm93c2Vyc1xuICByZXR1cm4gKCkgPT4ge1xuICAgIC8vIGR5bmFtaWNhbGx5IGdyYWIgbmV3IHRvcCBwb3NpdGlvbiBvZiBzY3JvbGxCb3R0b21UcmlnZ2VyXG4gICAgY29uc3Qgc2Nyb2xsQm90dG9tQm91bmRhcnlyUmVsYXRpdmUgPSBzY3JvbGxCb3R0b21Cb3VuZGFyeUFic29sdXRlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgICAudG9wO1xuICAgIC8vIGRldGVjdCBpZiB0b3BMZWZ0IG9mIHRyaWdnZXIgZWwgaXMgb25zY3JlZW5cbiAgICAvLyBoYXMgdG8gYmUgYmV0d2VlbiAwIGFuZCB0aGUgaGVpZ2h0IG9mIHRoZSB2aWV3cG9ydFxuICAgIGlmIChzY3JvbGxCb3R0b21Cb3VuZGFyeXJSZWxhdGl2ZSA+IDAgJiYgc2Nyb2xsQm90dG9tQm91bmRhcnlyUmVsYXRpdmUgPD0gdmgpIHtcbiAgICAgIC8vIGFkZCBuYXZiYXIgYW5kIHRlbGwgc2NyZWVuIHJlYWRlcnMgaXQgaXMgdmlzaWJsZVxuICAgICAgbmF2YmFyU2Nyb2xsLmNsYXNzTGlzdC5hZGQoJ2wtbmF2YmFyLXNjcm9sbC0taXMtdmlzaWJsZScpO1xuICAgICAgbExvZ29GaXhlZC5jbGFzc0xpc3QuYWRkKCduYXZiYXItbW9iaWxlLS1pcy12aXNpYmxlJyk7XG4gICAgICBuYXZiYXJTY3JvbGwuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICdmYWxzZScpO1xuICAgIH1cbiAgICBpZiAoIW5hdmJhclNjcm9sbC5jbGFzc0xpc3QuY29udGFpbnMoJ2wtbmF2YmFyLXNjcm9sbC0taXMtdmlzaWJsZScpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIGR5bmFtaWNhbGx5IGdyYWIgbmV3IHRvcCBwb3NpdGlvbiBvZiBzY3JvbGxUb3BCb3VuZGFyeVxuICAgIGNvbnN0IHNjcm9sbFRvcEJvdW5kYXJ5UmVsYXRpdmUgPSBzY3JvbGxUb3BCb3VuZGFyeUFic29sdXRlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcbiAgICBpZiAoc2Nyb2xsVG9wQm91bmRhcnlSZWxhdGl2ZSA+IDApIHtcbiAgICAgIC8vIHJlbW92ZSBuYXZiYXIgYW5kIHRlbGwgc2NyZWVuIHJlYWRlcnMgaXQgaXMgbm8gbG9uZ2VyIHZpc2libGVcbiAgICAgIG5hdmJhclNjcm9sbC5jbGFzc0xpc3QucmVtb3ZlKCdsLW5hdmJhci1zY3JvbGwtLWlzLXZpc2libGUnKTtcbiAgICAgIGxMb2dvRml4ZWQuY2xhc3NMaXN0LnJlbW92ZSgnbmF2YmFyLW1vYmlsZS0taXMtdmlzaWJsZScpO1xuICAgICAgbmF2YmFyU2Nyb2xsLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xuICAgIH1cbiAgfTtcbn0oKSk7XG5cbmNvbnN0IG1vZGFsID0gKGZ1bmN0aW9uIG1vZGFsU2NvcGUoKSB7XG4gIGNvbnN0IHRhYlN3aXRjaEJ1dHRvbnMgPSBBcnJheS5mcm9tKHRhYlN3aXRjaGVzLnF1ZXJ5U2VsZWN0b3JBbGwoJ2J1dHRvbicpKTtcbiAgY29uc3QgW2hvbWVTd2l0Y2gsIHVzZXJTd2l0Y2hdID0gdGFiU3dpdGNoZXMucXVlcnlTZWxlY3RvckFsbCgnLmpzLXRhYi1zd2l0Y2gnKTtcbiAgY29uc3QganNNb2RhbE1lbnUgPSBqc01vZGFscy5xdWVyeVNlbGVjdG9yKCcuanMtbW9kYWwtbWVudScpO1xuICBjb25zdCBqc01vZGFsRm9ybSA9IGpzTW9kYWxzLnF1ZXJ5U2VsZWN0b3IoJy5qcy1tb2RhbC1mb3JtJyk7XG4gIGNvbnN0IGtpbmphQ2xvc2VJY29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLWljb24tY2xvc2Uta2luamEnKTtcbiAgY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcbiAgbGV0IHByZXZpb3VzQWN0aXZlRWw7XG4gIGxldCBtb2RhbEZpcnN0Rm9jdXNlZCA9IGZhbHNlO1xuXG4gIGZ1bmN0aW9uIG1vZGFsVHJhcEZvY3VzKG1vZGFsRWwpIHtcbiAgICBsZXQgbW9kYWxGb2N1c2FibGVFbHM7XG4gICAgbGV0IGZvY3VzYWJsZUVscztcbiAgICAvLyBzdG9yZSBwcmV2aW91cyBhY3RpdmUgZWxlbWVudCBzbyBpdCBpcyBvbiBmb2N1cyB3aGVuIHVzZXIgZXhpdHMgbW9kYWxcbiAgICBwcmV2aW91c0FjdGl2ZUVsID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcbiAgICAvLyBmaW5kIGFjdGl2ZSBtb2RhbFxuICAgIGlmIChqc01vZGFsTWVudS5jbGFzc0xpc3QuY29udGFpbnMoJ2wtbW9kYWwtLWlzLXZpc2libGUnKSkge1xuICAgICAgbW9kYWxGb2N1c2FibGVFbHMgPSBBcnJheS5mcm9tKFxuICAgICAgICBqc01vZGFsTWVudS5xdWVyeVNlbGVjdG9yQWxsKFxuICAgICAgICAgICdhW2hyZWZdLCBidXR0b24sIHRleHRhcmVhLCBpbnB1dFt0eXBlPVwidGV4dFwiXSwgaW5wdXRbdHlwZT1cInJhZGlvXCJdLCBpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0sIHNlbGVjdCcsXG4gICAgICAgICksXG4gICAgICApO1xuICAgIH0gZWxzZSBpZiAoanNNb2RhbEZvcm0uY2xhc3NMaXN0LmNvbnRhaW5zKCdsLW1vZGFsLS1pcy12aXNpYmxlJykpIHtcbiAgICAgIG1vZGFsRm9jdXNhYmxlRWxzID0gQXJyYXkuZnJvbShcbiAgICAgICAganNNb2RhbEZvcm0ucXVlcnlTZWxlY3RvckFsbChcbiAgICAgICAgICAnYVtocmVmXSwgYnV0dG9uLCB0ZXh0YXJlYSwgaW5wdXRbdHlwZT1cInRleHRcIl0sIGlucHV0W3R5cGU9XCJyYWRpb1wiXSwgaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdLCBzZWxlY3QnLFxuICAgICAgICApLFxuICAgICAgKTtcbiAgICB9XG4gICAgLy8gaWYgdGFiU3dpdGNoIGhlYWRlciBpcyB2aXNpYmxlLFxuICAgIC8vIGNvbmNhdCBhY3RpdmUgbW9kYWwgbGlua3MgdG8gdGhlIGZpeGVkIGhlYWRlciAoc2libGluZyBlbGVtZW50KTtcbiAgICBpZiAodGFiU3dpdGNoZXMuY2xhc3NMaXN0LmNvbnRhaW5zKCd0YWItc3dpdGNoZXMtLWlzLXZpc2libGUnKSkge1xuICAgICAgZm9jdXNhYmxlRWxzID0gdGFiU3dpdGNoQnV0dG9ucy5jb25jYXQobW9kYWxGb2N1c2FibGVFbHMpO1xuICAgICAgLy8gZWxzZSBqdXN0IHByZXNlcnZlIGFjdGl2ZSBtb2RhbCBsaW5rc1xuICAgIH0gZWxzZSB7XG4gICAgICBmb2N1c2FibGVFbHMgPSBtb2RhbEZvY3VzYWJsZUVscztcbiAgICB9XG4gICAgLy8gZmluZCBmaXJzdCBhbmQgbGFzdCBmb2N1c2FibGUgZWwgaW4gbW9kYWxcbiAgICBjb25zdCBmaXJzdEZvY3VzYWJsZUVsID0gZm9jdXNhYmxlRWxzWzBdO1xuICAgIGNvbnN0IGxhc3RGb2N1c2FibGVFbCA9IGZvY3VzYWJsZUVsc1tmb2N1c2FibGVFbHMubGVuZ3RoIC0gMV07XG4gICAgLy8gIGZvY3VzIGZpcnN0IGVsIG9ubHkgb24gaW5pdGlhbCBvcGVuOyByZXNldCBzdGF0ZSBiYWNrIHRvIGZhbHNlIHdoZW4gbW9kYWwgaXMgY2xvc2VkXG4gICAgaWYgKCFtb2RhbEZpcnN0Rm9jdXNlZCkge1xuICAgICAgLy8gZGVsYXkgdG8gYWxsb3cgbW9kYWwgdG8gZGlzcGxheSwgdGhlbiBmb2N1c1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGZpcnN0Rm9jdXNhYmxlRWwuZm9jdXMoKTtcbiAgICAgIH0sIDEwMCk7XG4gICAgfVxuICAgIC8vIGNoYW5nZSBmaXJzdEZvY3VzZWQgc3RhdGUgdHJ1ZSBzbyB0aGF0IGl0IGRvZXNuJ3QgcmVmb2N1cyB3aGVuIHRvZ2dsaW5nIG1vZGFsc1xuICAgIG1vZGFsRmlyc3RGb2N1c2VkID0gdHJ1ZTtcbiAgICAvLyBkaXNyZWdhcmQgbm9uIHRhYiBrZXkgZXZlbnRzXG4gICAgbW9kYWxFbC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGUpID0+IHtcbiAgICAgIGlmIChlLmtleSAhPT0gJ1RhYicpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgLy8gaWYgdGFiICsgc2hpZnRcbiAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSBmaXJzdEZvY3VzYWJsZUVsKSB7XG4gICAgICAgICAgbGFzdEZvY3VzYWJsZUVsLmZvY3VzKCk7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IGxhc3RGb2N1c2FibGVFbCkge1xuICAgICAgICAvLyBpZiBqdXN0IHRhYiBwcmVzcyBhbmQgYXQgZW5kIG9mIGZvY3VzYWJsZSBlbHMgLiAuIC5cbiAgICAgICAgZmlyc3RGb2N1c2FibGVFbC5mb2N1cygpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyBoYW1idXJnZXItbWVudSBleHBhbmQgYW5kIGNvbGxhcHNlXG4gIGZ1bmN0aW9uIGRpc3BsYXlNb2RhbE1lbnUoKSB7XG4gICAgLy8gcmVtb3ZlIHNjcm9sbCBmcm9tIGJvZHlcbiAgICBib2R5LmNsYXNzTGlzdC50b2dnbGUoJ25vLXNjcm9sbCcpO1xuICAgIC8vIHRvZ2dsZSB0aGUgZGlzcGxheSBvZiBtb2RhbFxuICAgIGpzTW9kYWxNZW51LmNsYXNzTGlzdC50b2dnbGUoJ2wtbW9kYWwtLWlzLXZpc2libGUnKTtcbiAgICAvLyBkaXNwbGF5IGZpeGVkIGhlYWRlciBmb3IgbW9kYWxcbiAgICB0YWJTd2l0Y2hlcy5jbGFzc0xpc3QuYWRkKCd0YWItc3dpdGNoZXMtLWlzLXZpc2libGUnKTtcbiAgICAvLyByZW1vdmUgZGVmYXVsdCB4IGljb24gaW4ganNNb2RhbEZvcm07IGl0IGlzIHN1cHBsaWVkIGJ5IGZpeGVkIGhlYWRlciBpbiB0aGlzIGluc3RhbmNlXG4gICAga2luamFDbG9zZUljb24uY2xhc3NMaXN0LmFkZCgnaWNvbi1jbG9zZS0taXMtaGlkZGVuJyk7XG4gICAgbW9kYWxUcmFwRm9jdXMoanNNb2RhbHMpO1xuICB9XG5cbiAgLy8gZGlzcGxheSBhbmQgcmVtb3ZlIG1vZGFsIG9uIGljb24gY2xpY2tzIG91dHNpZGUgb2YgaGFtYnVyZ2VyIHRvZ2dsZXJcbiAgZnVuY3Rpb24gZGlzcGxheU1vZGFsRm9ybSgpIHtcbiAgICAvLyByZW1vdmUgc2Nyb2xsIGZyb20gYm9keVxuICAgIGlmICghYm9keS5jbGFzc0xpc3QuY29udGFpbnMoJ25vLXNjcm9sbCcpKSB7XG4gICAgICBib2R5LmNsYXNzTGlzdC5hZGQoJ25vLXNjcm9sbCcpO1xuICAgIH1cbiAgICAvLyBkaXNwbGF5IG1vZGFsXG4gICAganNNb2RhbEZvcm0uY2xhc3NMaXN0LmFkZCgnbC1tb2RhbC0taXMtdmlzaWJsZScpO1xuICAgIC8vIGZvY3VzLXRyYXBcbiAgICBtb2RhbFRyYXBGb2N1cyhqc01vZGFsRm9ybSk7XG4gIH1cblxuICAvLyBjbGlja3Mgb24gdGFiU3dpdGNoZXNcbiAgZnVuY3Rpb24gc3dpdGNoTW9kYWwoZSkge1xuICAgIGlmICghZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCd0YWItc3dpdGNoZXNfX2l0ZW0nKSkge1xuICAgICAgLy8gb25seSBjaGFuZ2UgaWYgbm90IGN1cnJlbnRseSBhY3RpdmVcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3RhYi1zd2l0Y2hlc19faXRlbS0taXMtYWN0aXZlJykpIHtcbiAgICAgIC8vIGdyYWIgYWN0aXZlVGFiICh0aGVyZSBjYW4gb25seSBiZSBvbmUgYWN0aXZlVGFiIGF0IGEgdGltZSlcbiAgICAgIGNvbnN0IGFjdGl2ZVRhYiA9IHRhYlN3aXRjaGVzLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICcudGFiLXN3aXRjaGVzX19pdGVtLS1pcy1hY3RpdmUnLFxuICAgICAgKTtcbiAgICAgIC8vIHJlbW92ZSBhY3RpdmUgc3RhdGUgZnJvbSBhY3RpdmVUYWJcbiAgICAgIGFjdGl2ZVRhYi5jbGFzc0xpc3QucmVtb3ZlKCd0YWItc3dpdGNoZXNfX2l0ZW0tLWlzLWFjdGl2ZScpO1xuICAgICAgLy8gdXBkYXRlIGFyaWEtcHJlc3NlZFxuICAgICAgYWN0aXZlVGFiLnNldEF0dHJpYnV0ZSgnYXJpYS1wcmVzc2VkJywgJ2ZhbHNlJyk7XG4gICAgICAvLyBhZGQgYWN0aXZlIGJhY2tncm91bmQgY29sb3Igb24gbmV3bHkgYWN0aXZhdGVkIHRhYlxuICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LmFkZCgndGFiLXN3aXRjaGVzX19pdGVtLS1pcy1hY3RpdmUnKTtcbiAgICAgIGUudGFyZ2V0LnNldEF0dHJpYnV0ZSgnYXJpYS1wcmVzc2VkJywgJ3RydWUnKTtcbiAgICAgIC8vIHN3aXRjaCBtb2RhbHNcbiAgICAgIGpzTW9kYWxNZW51LmNsYXNzTGlzdC50b2dnbGUoJ2wtbW9kYWwtLWlzLXZpc2libGUnKTtcbiAgICAgIGpzTW9kYWxGb3JtLmNsYXNzTGlzdC50b2dnbGUoJ2wtbW9kYWwtLWlzLXZpc2libGUnKTtcbiAgICAgIGpzTW9kYWxGb3JtLmNsYXNzTGlzdC50b2dnbGUoJ2wtbW9kYWwtLXRvcC1vZmZzZXQnKTtcbiAgICB9XG4gICAgLy8gdXBkYXRlIGZvY3VzYWJsZSBlbGVtZW50c1xuICAgIG1vZGFsVHJhcEZvY3VzKGpzTW9kYWxzKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsb3NlTW9kYWwoKSB7XG4gICAgY29uc3QgbE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmwtbW9kYWwtLWlzLXZpc2libGUnKTtcbiAgICAvLyBkaXNhcHBlYXIgdGhlIGwtbW9kYWwgYW5kIHRoZSB0YWJTd2l0Y2ggY29udGFpbmVyXG4gICAgbE1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2wtbW9kYWwtLWlzLXZpc2libGUnKTtcbiAgICB0YWJTd2l0Y2hlcy5jbGFzc0xpc3QucmVtb3ZlKCd0YWItc3dpdGNoZXMtLWlzLXZpc2libGUnKTtcbiAgICAvLyByZXN0b3JlIHJlZ3VsYXIgY2xvc2UgaWNvbiB0byBLaW5qYSBpbiBjYXNlIGFjY2Vzc2VkIHRocm91Z2ggaWNvbi11c2VyIG9uIGhvbWUgcGFnZVxuICAgIGtpbmphQ2xvc2VJY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2ljb24tY2xvc2UtLWlzLWhpZGRlbicpO1xuICAgIC8vIHJlc3RvcmUgc2Nyb2xsIHRvIGJvZHlcbiAgICBib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ25vLXNjcm9sbCcpO1xuICAgIC8vIHJldmVydCBiYWNrIHRvIGhvbWVTd2l0Y2ggaW4gdGhlIGV2ZW50IHRoYXQgeW91IGNsb3NlIHdoZW4gdGhlIHVzZXJTd2l0Y2ggaXMgYWN0aXZlXG4gICAgaWYgKCFob21lU3dpdGNoLmNsYXNzTGlzdC5jb250YWlucygndGFiLXN3aXRjaGVzX19pdGVtLS1pcy1hY3RpdmUnKSkge1xuICAgICAgaG9tZVN3aXRjaC5jbGFzc0xpc3QuYWRkKCd0YWItc3dpdGNoZXNfX2l0ZW0tLWlzLWFjdGl2ZScpO1xuICAgICAgaG9tZVN3aXRjaC5zZXRBdHRyaWJ1dGUoJ2FyaWEtcHJlc3NlZCcsICd0cnVlJyk7XG4gICAgICB1c2VyU3dpdGNoLmNsYXNzTGlzdC5yZW1vdmUoJ3RhYi1zd2l0Y2hlc19faXRlbS0taXMtYWN0aXZlJyk7XG4gICAgICB1c2VyU3dpdGNoLnNldEF0dHJpYnV0ZSgnYXJpYS1wcmVzc2VkJywgJ2ZhbHNlJyk7XG4gICAgICAvLyByZW1vdmUgdGhlIG9mZnNldDsgbm8gbmVlZCB3aGVuIHZpZXdlZCB2aWEgdXNlciBpY29uXG4gICAgICBqc01vZGFsRm9ybS5jbGFzc0xpc3QucmVtb3ZlKCdsLW1vZGFsLS10b3Atb2Zmc2V0Jyk7XG4gICAgfVxuICAgIC8vIHNldCBmaXJzdCBlbCBmb2N1cyBzdGF0ZSBiYWNrIHRvIGZhbHNlXG4gICAgbW9kYWxGaXJzdEZvY3VzZWQgPSBmYWxzZTtcbiAgICAvLyBwdXQgZm9jdXMgb24gcHJlLW1vZGFsIHN0YXRlXG4gICAgcHJldmlvdXNBY3RpdmVFbC5mb2N1cygpO1xuICB9XG4gIHJldHVybiB7XG4gICAgdHJhcEZvY3VzOiBtb2RhbFRyYXBGb2N1cyxcbiAgICBkaXNwbGF5TWVudTogZGlzcGxheU1vZGFsTWVudSxcbiAgICBkaXNwbGF5Rm9ybTogZGlzcGxheU1vZGFsRm9ybSxcbiAgICBzd2l0Y2g6IHN3aXRjaE1vZGFsLFxuICAgIGNsb3NlOiBjbG9zZU1vZGFsLFxuICB9O1xufSgpKTtcblxuZnVuY3Rpb24gc3RvcFN1Ym1pc3Npb24oZSkge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG59XG5cbi8vIHZhbGlkYXRlIGZpZWxkcyBpbiBLaW5qYSBmb3JtXG5mdW5jdGlvbiB2YWxpZGF0ZUZpZWxkKGlucHV0LCBtZXNzYWdlLCB3YXJuaW5nSWQpIHtcbiAgLy8gaWYgdGhlcmUgaXMgbm8gaW5wdXQgYW5kIHRoZSB3YXJuaW5nIGN1cnJlbnRseSBpcyBoaWRkZW4sIGRpc3BsYXkgd2FybmluZ1xuICBpZiAoIWlucHV0LnZhbHVlICYmIG1lc3NhZ2UuY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRlJykpIHtcbiAgICBtZXNzYWdlLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ2FyaWEtaW52YWxpZCcsICd0cnVlJyk7XG4gICAgaW5wdXQuc2V0QXR0cmlidXRlKCdhcmlhLWRlc2NyaWJlZGJ5Jywgd2FybmluZ0lkKTtcblxuICAgIGlucHV0LmZvY3VzKCk7XG4gICAgLy8gaWYgd2FybmluZyBpcyBkaXNwbGF5ZWQgYnV0IGlucHV0IGlzIHVwZGF0ZWQsIGhpZGUgd2FybmluZ1xuICB9IGVsc2UgaWYgKGlucHV0LnZhbHVlICYmICFtZXNzYWdlLmNsYXNzTGlzdC5jb250YWlucygnaGlkZScpKSB7XG4gICAgbWVzc2FnZS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgaW5wdXQuc2V0QXR0cmlidXRlKCdhcmlhLWludmFsaWQnLCAnZmFsc2UnKTtcbiAgICBpbnB1dC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtZGVzY3JpYmVkYnknKTtcbiAgfVxufVxuXG4vLyBiYXNpYyBmb3JtIHZhbGlkYXRpb25cbmNvbnN0IHZhbGlkYXRlRm9ybSA9IChmdW5jdGlvbiB2YWxpZGF0ZUZvcm1TY29wZSgpIHtcbiAgY29uc3QgdXNlck5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcm5hbWUnKTtcbiAgY29uc3QgdXNlck5hbWVFcnJvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqcy11c2VybmFtZS1lcnJvcicpO1xuICBjb25zdCBrZXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgna2V5Jyk7XG4gIGNvbnN0IGtleUVycm9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pzLWtleS1lcnJvcicpO1xuXG4gIHJldHVybiAoZSkgPT4ge1xuICAgIHZhbGlkYXRlRmllbGQodXNlck5hbWUsIHVzZXJOYW1lRXJyb3IsICdqcy11c2VybmFtZS1lcnJvcicpO1xuICAgIHZhbGlkYXRlRmllbGQoa2V5LCBrZXlFcnJvciwgJ2pzLWtleS1lcnJvcicpO1xuXG4gICAgLy8gcHJldmVudCBmb3JtIGZyb20gc3VibWl0dGluZzsgbm8gc2VydmVyIHNpZGUgY29kZVxuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgfTtcbn0oKSk7XG5cbmNvbnN0IHRvZ2dsZVNlYXJjaEJhciA9IChmdW5jdGlvbiB0b2dnbGVTZWFyY2hCYXJTY29wZSgpIHtcbiAgY29uc3Qgc3ZnVG9nZ2xlciA9IHNlYXJjaGJhci5xdWVyeVNlbGVjdG9yKCcuanMtc2VhcmNoYmFyLXN2ZycpO1xuICBjb25zdCBzdmdVc2UgPSBzdmdUb2dnbGVyLnF1ZXJ5U2VsZWN0b3IoJ3VzZScpO1xuICByZXR1cm4gKGUpID0+IHtcbiAgICBpZiAoIWUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnanMtc2VhcmNoYmFyLXRvZ2dsZXInKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoc3ZnVG9nZ2xlci5jbGFzc0xpc3QuY29udGFpbnMoJ2ljb24tc2VhcmNoJykpIHtcbiAgICAgIHN2Z1RvZ2dsZXIuY2xhc3NMaXN0LnJlbW92ZSgnaWNvbi1zZWFyY2gnKTtcbiAgICAgIHN2Z1RvZ2dsZXIuY2xhc3NMaXN0LmFkZChcbiAgICAgICAgJ2ljb24tY2xvc2UnLFxuICAgICAgICAnaWNvbi1jbG9zZS0tc20nLFxuICAgICAgICAnaWNvbi1jbG9zZS0tZ3JleScsXG4gICAgICApO1xuICAgICAgc3ZnVXNlLnNldEF0dHJpYnV0ZSgnaHJlZicsICcjaWNvbi1jbG9zZScpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdmdUb2dnbGVyLmNsYXNzTGlzdC5yZW1vdmUoXG4gICAgICAgICdpY29uLWNsb3NlJyxcbiAgICAgICAgJ2ljb24tY2xvc2UtLXNtJyxcbiAgICAgICAgJ2ljb24tY2xvc2UtLWdyZXknLFxuICAgICAgKTtcbiAgICAgIHN2Z1RvZ2dsZXIuY2xhc3NMaXN0LmFkZCgnaWNvbi1zZWFyY2gnKTtcbiAgICAgIHN2Z1VzZS5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCAnI2ljb24tc2VhcmNoJyk7XG4gICAgfVxuICAgIHNlYXJjaGJhci5jbGFzc0xpc3QudG9nZ2xlKCdzZWFyY2hiYXItLWlzLWV4cGFuZGVkJyk7XG4gICAgdXBkYXRlQXJpYUV4cGFuZGVkKGUpO1xuICAgIC8vIHRoZXJlIGlzIGFuIG92ZXJsYXkgb2JzY3VyaW5nIHRoZSBtZW51IGl0ZW1zLFxuICAgIC8vIGJ1dCBpdCBzdGlsbCBzaG93cyBpbiBzb21lIGNvbnRleHRzLCBzbyBkaXNhcHBlYXIgaXRcbiAgICB0b3BOYXZMaXN0LmNsYXNzTGlzdC50b2dnbGUoJ3RvcC1uYXZfX2xpc3QtLWlzLWhpZGRlbicpO1xuICAgIC8vIGlmIGRyb3Bkb3duIG1lbnUgaXMgdmlzaWJsZSB3aGVuIG1hZ25pZnlpbmcgZ2xhc3MgaXMgY2xpY2tlZCwgZGlzYXBwZWFyIGl0XG4gICAgY29uc3QgZHJvcGRvd25Db250YWluZXIgPSB0b3BOYXYucXVlcnlTZWxlY3RvcignLmRyb3Bkb3duLS1pcy12aXNpYmxlJyk7XG4gICAgaWYgKGRyb3Bkb3duQ29udGFpbmVyKSB7XG4gICAgICBkcm9wZG93bkNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdkcm9wZG93bi0taXMtdmlzaWJsZScpO1xuICAgIH1cbiAgfTtcbn0oKSk7XG5cbmNvbnN0IHJlZWxUcmFuc2l0aW9uID0gKGZ1bmN0aW9uIHJlZWxUcmFuc2l0aW9uU2NvcGUoKSB7XG4gIGNvbnN0IHJlZWxBcnRpY2xlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1yZWVsLWFydGljbGVzJyk7XG4gIGNvbnN0IHRodW1ibmFpbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucmVlbC1zdG9yeV9fdGh1bWJuYWlsLWl0ZW0nKTtcbiAgY29uc3QgcmVlbFN0b3JpZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucmVlbC1zdG9yeScpO1xuICBjb25zdCBwcm9ncmVzc0JhckZpbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmotcHJvZ3Jlc3MtYmFyX19maWxsJyk7XG4gIGNvbnN0IGRlbGF5ID0gNTAwMDtcbiAgbGV0IGN1cnJlbnQgPSAwO1xuICBsZXQgcHJldmlvdXNBY3RpdmVUaHVtYm5haWw7XG4gIGxldCBwcmV2aW91c0FjdGl2ZUFydGljbGU7XG4gIGxldCB0aW1lb3V0O1xuICBsZXQgc3RhcnQ7XG4gIGxldCByZW1haW5pbmc7XG4gIGxldCBmb3JtZXJBY3RpdmVUaHVtYjtcbiAgbGV0IGZvcm1lckFjdGl2ZUFydGljbGU7XG4gIGxldCBjdXJyZW50VGh1bWJuYWlsTGk7XG4gIGxldCBjdXJyZW50QXJ0aWNsZTtcbiAgbGV0IHRpY2tpbmdQcm9ncmVzc0ZpbGw7XG5cbiAgLy8gc2V0VGltZW91dCB0cmlnZ2VyZWQgYXJ0aWNsZSByZWVsXG4gIGZ1bmN0aW9uIGF1dG9SZWVsKCkge1xuICAgIC8vIHJlbWFpbmluZyB0aW1lIGlzIGluaXRpYWxseSB0aGUgc2FtZSBhcyB0aGUgZGVsYXkgZHVyYXRpb25cbiAgICByZW1haW5pbmcgPSBkZWxheTtcbiAgICAvLyBncmFiIHN0YXJ0IHRpbWUgZm9yIHdoZW4geW91IHBhdXNlIHRpbWVvdXRcbiAgICBzdGFydCA9IERhdGUubm93KCk7XG4gICAgLy8gaWYgbm90IHRoZSBmaXJzdCBmdW5jdGlvbiBjYWxsIGZyb20gb25sb2FkXG4gICAgaWYgKHByZXZpb3VzQWN0aXZlVGh1bWJuYWlsKSB7XG4gICAgICAvLyByZW1vdmUgYWN0aXZlIGNsYXNzZXMgZnJvbSBwcmV2aW91cyBlbGVtZW50c1xuICAgICAgcHJldmlvdXNBY3RpdmVUaHVtYm5haWwuY2xhc3NMaXN0LnJlbW92ZShcbiAgICAgICAgJ3JlZWwtc3RvcnlfX3RodW1ibmFpbC1pdGVtLS1pcy1hY3RpdmUnLFxuICAgICAgKTtcbiAgICAgIHByZXZpb3VzQWN0aXZlQXJ0aWNsZS5jbGFzc0xpc3QucmVtb3ZlKCdyZWVsLXN0b3J5LS1pcy1hY3RpdmUnKTtcbiAgICAgIC8vIGlmIHlvdSBhcmUgYXQgdGhlIGVuZCBvZiB0aGUgbG9vcFxuICAgICAgaWYgKHByZXZpb3VzQWN0aXZlVGh1bWJuYWlsID09PSB0aHVtYm5haWxzW3RodW1ibmFpbHMubGVuZ3RoIC0gMV0pIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcm9ncmVzc0JhckZpbGxzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgLy8gcmVzZXQgYWxsIHRoZSBmaWxscyBiYWNrIHRvIDBcbiAgICAgICAgICBwcm9ncmVzc0JhckZpbGxzW2ldLmNsYXNzTGlzdC5yZW1vdmUoXG4gICAgICAgICAgICAnai1wcm9ncmVzcy1iYXJfX2ZpbGwtLWlzLWFjdGl2ZScsXG4gICAgICAgICAgKTtcbiAgICAgICAgICAvLyB2b2lkIG9mZnNldFdpZHRoIGluIG9yZGVyIHRvIHJlc3RhcnQgYW5pbWF0aW9uXG4gICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXZvaWRcbiAgICAgICAgICB2b2lkIHByb2dyZXNzQmFyRmlsbHNbaV0ub2Zmc2V0V2lkdGg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgLy8gYWRkIGFjdGl2ZSBjbGFzc2VzIHRvIGN1cnJlbnQgZWxlbWVudHNcbiAgICB0aHVtYm5haWxzW2N1cnJlbnRdLmNsYXNzTGlzdC5hZGQoJ3JlZWwtc3RvcnlfX3RodW1ibmFpbC1pdGVtLS1pcy1hY3RpdmUnKTtcbiAgICByZWVsU3Rvcmllc1tjdXJyZW50XS5jbGFzc0xpc3QuYWRkKCdyZWVsLXN0b3J5LS1pcy1hY3RpdmUnKTtcbiAgICBwcm9ncmVzc0JhckZpbGxzW2N1cnJlbnRdLmNsYXNzTGlzdC5hZGQoJ2otcHJvZ3Jlc3MtYmFyX19maWxsLS1pcy1hY3RpdmUnKTtcbiAgICAvLyBzdG9yZSBwcmV2aW91cyBhY3RpdmUgZWxlbWVudHNcbiAgICBwcmV2aW91c0FjdGl2ZVRodW1ibmFpbCA9IHRodW1ibmFpbHNbY3VycmVudF07XG4gICAgcHJldmlvdXNBY3RpdmVBcnRpY2xlID0gcmVlbFN0b3JpZXNbY3VycmVudF07XG4gICAgdGlja2luZ1Byb2dyZXNzRmlsbCA9IHByb2dyZXNzQmFyRmlsbHNbY3VycmVudF07XG4gICAgLy8gaWYgYXQgZW5kIG9mIGxvb3AsIHN0YXJ0IGFnYWluIGZyb20gMDsgZWxzZSBpdGVyYXRlXG4gICAgaWYgKGN1cnJlbnQgPT09IHRodW1ibmFpbHMubGVuZ3RoIC0gMSkge1xuICAgICAgY3VycmVudCA9IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGN1cnJlbnQgKz0gMTtcbiAgICB9XG4gICAgLy8gcnVuIHRoZSB0aW1lb3V0OyBkZWxheSB0aW1lIGlzIHNldCBlcXVhbCB0byB0aGUgdGltZSBzcGVjaWZpZWRcbiAgICAvLyBpbiBqLXByb2dyZXNzLWJhcl9fZmlsbC0taXMtYWN0aXZlIGFuaW1hdGlvbiBwcm9wZXJ0eVxuICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGF1dG9SZWVsLCBkZWxheSk7XG4gIH1cblxuICAvLyB0cmFuc2l0aW9uIGFydGljbGUgdmlhIGhvdmVyXG4gIGZ1bmN0aW9uIHBhdXNlVGltZXIoZSkge1xuICAgIC8vIHBhdXNlIHRoZSBjc3MgYW5pbWF0aW9uIG9uIHRoZSBmaWxsXG4gICAgdGlja2luZ1Byb2dyZXNzRmlsbC5jbGFzc0xpc3QuYWRkKCdqLXByb2dyZXNzLWJhcl9fZmlsbC0taXMtcGF1c2VkJyk7XG4gICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgfVxuICAgIHJlbWFpbmluZyAtPSBEYXRlLm5vdygpIC0gc3RhcnQ7XG4gICAgLy8gaW5pdCBwcmV2aW91c2x5IGFjdGl2YXRlZCBpdGVtXG4gICAgZm9ybWVyQWN0aXZlVGh1bWIgPSByZWVsU3RvcnlOYXYucXVlcnlTZWxlY3RvcihcbiAgICAgICcucmVlbC1zdG9yeV9fdGh1bWJuYWlsLWl0ZW0tLWlzLWFjdGl2ZScsXG4gICAgKTtcbiAgICAvLyBpbml0IHByZXZpb3VzbHkgYWN0aXZhdGVkIGl0ZW1cbiAgICBmb3JtZXJBY3RpdmVBcnRpY2xlID0gcmVlbEFydGljbGVzLnF1ZXJ5U2VsZWN0b3IoJy5yZWVsLXN0b3J5LS1pcy1hY3RpdmUnKTtcbiAgICAvLyByZXNldCBmb3JtZXJseSBhY3RpdmUgaW1nIHRvIGRlZmF1bHQgc3RhdGVcbiAgICBmb3JtZXJBY3RpdmVUaHVtYi5jbGFzc0xpc3QucmVtb3ZlKCdyZWVsLXN0b3J5X190aHVtYm5haWwtaXRlbS0taXMtYWN0aXZlJyk7XG4gICAgLy8gcmVzZXQgZm9ybWVybHkgYWN0aXZlIGFydGljbGUgdG8gZGVmYXVsdCBzdGF0ZVxuICAgIGZvcm1lckFjdGl2ZUFydGljbGUuY2xhc3NMaXN0LnJlbW92ZSgncmVlbC1zdG9yeS0taXMtYWN0aXZlJyk7XG4gICAgLy8gZ3JhYiBhbHQgdmFsdWUgb2YgZS50YXJnZXQncyBpbWdcbiAgICBjdXJyZW50VGh1bWJuYWlsTGkgPSBlLnRhcmdldC5wYXJlbnRFbGVtZW50O1xuICAgIGNvbnN0IGN1cnJlbnRUaHVtYm5haWxJbWcgPSBjdXJyZW50VGh1bWJuYWlsTGkucXVlcnlTZWxlY3RvcignaW1nJyk7XG4gICAgY29uc3QgY3VycmVudFRodW1ibmFpbEFsdCA9IGN1cnJlbnRUaHVtYm5haWxJbWcuZ2V0QXR0cmlidXRlKCdhbHQnKTtcbiAgICAvLyBmaW5kIGNvcnJlc3BvbmRpbmcgYXJ0aWNsZSBiYXNlZCBvbiBpbWcgYWx0LCBhbmQgY2xpbWIgdG8gYW5jZXN0b3IgcmVlbC1zdG9yeVxuICAgIGN1cnJlbnRBcnRpY2xlID0gcmVlbEFydGljbGVzXG4gICAgICAucXVlcnlTZWxlY3RvcihgaW1nW2FsdD1cIiR7Y3VycmVudFRodW1ibmFpbEFsdH1cIl1gKVxuICAgICAgLmNsb3Nlc3QoJy5yZWVsLXN0b3J5Jyk7XG4gICAgLy8gYWN0aXZhdGUgdGh1bWJuYWlsIGFuZCBhcnRpY2xlXG4gICAgY3VycmVudFRodW1ibmFpbExpLmNsYXNzTGlzdC5hZGQoJ3JlZWwtc3RvcnlfX3RodW1ibmFpbC1pdGVtLS1pcy1hY3RpdmUnKTtcbiAgICBjdXJyZW50QXJ0aWNsZS5jbGFzc0xpc3QuYWRkKCdyZWVsLXN0b3J5LS1pcy1hY3RpdmUnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlc3VtZVRpbWVyKCkge1xuICAgIC8vIHJlc3VtZSBhbmltYXRpb25cbiAgICB0aWNraW5nUHJvZ3Jlc3NGaWxsLmNsYXNzTGlzdC5yZW1vdmUoJ2otcHJvZ3Jlc3MtYmFyX19maWxsLS1pcy1wYXVzZWQnKTtcbiAgICAvLyBuZXcgc3RhcnQgdmFsdWUgaXMgdXNlZFxuICAgIC8vIGluIHRoZSBldmVudCB0aGF0IHVzZXIgbW91c2VvdmVycyBhbmQgbW91c2VvdXRzIG11bHRpcGxlIHRpbWVzIGJlZm9yZSByZXR1cm5pbmcgYXV0byBhZ2FpblxuICAgIHN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgICAvLyBkZWFjdGl2YXRlIGhvdmVyZWQgaXRlbXNcbiAgICBjdXJyZW50VGh1bWJuYWlsTGkuY2xhc3NMaXN0LnJlbW92ZShcbiAgICAgICdyZWVsLXN0b3J5X190aHVtYm5haWwtaXRlbS0taXMtYWN0aXZlJyxcbiAgICApO1xuICAgIGN1cnJlbnRBcnRpY2xlLmNsYXNzTGlzdC5yZW1vdmUoJ3JlZWwtc3RvcnktLWlzLWFjdGl2ZScpO1xuICAgIC8vIHJlYWN0aXZhdGUgYXV0byBzZWxlY3RlZCBpdGVtc1xuICAgIGZvcm1lckFjdGl2ZVRodW1iLmNsYXNzTGlzdC5hZGQoJ3JlZWwtc3RvcnlfX3RodW1ibmFpbC1pdGVtLS1pcy1hY3RpdmUnKTtcbiAgICBmb3JtZXJBY3RpdmVBcnRpY2xlLmNsYXNzTGlzdC5hZGQoJ3JlZWwtc3RvcnktLWlzLWFjdGl2ZScpO1xuICAgIC8vIHdhaXQgb3V0IHJlbWFpbmluZyB0aW1lIGluIHRpbWVvdXQsIHRoZW4gbGV0IGF1dG8gcHJvY2VlZCB0byBuZXh0IGl0ZW1cbiAgICB0aW1lb3V0ID0gc2V0VGltZW91dChhdXRvUmVlbCwgcmVtYWluaW5nKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaG92ZXJJbjogcGF1c2VUaW1lcixcbiAgICBob3Zlck91dDogcmVzdW1lVGltZXIsXG4gICAgYXV0bzogYXV0b1JlZWwsXG4gIH07XG59KCkpO1xuXG4vLyBDaHJpcyBGZXJkaW5hbmRpJ3MgZGVib3VuY2UgZnVuY3Rpb25cbi8vIHZhciBkZWJvdW5jZSA9IGZ1bmN0aW9uKGZuKSB7XG4vLyAgIC8vIFNldHVwIGEgdGltZXJcbi8vICAgdmFyIHRpbWVvdXQ7XG5cbi8vICAgLy8gUmV0dXJuIGEgZnVuY3Rpb24gdG8gcnVuIGRlYm91bmNlZFxuLy8gICByZXR1cm4gZnVuY3Rpb24oKSB7XG4vLyAgICAgLy8gU2V0dXAgdGhlIGFyZ3VtZW50c1xuLy8gICAgIHZhciBjb250ZXh0ID0gdGhpcztcbi8vICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcblxuLy8gICAgIC8vIElmIHRoZXJlJ3MgYSB0aW1lciwgY2FuY2VsIGl0XG4vLyAgICAgaWYgKHRpbWVvdXQpIHtcbi8vICAgICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSh0aW1lb3V0KTtcbi8vICAgICB9XG5cbi8vICAgICAvLyBTZXR1cCB0aGUgbmV3IHJlcXVlc3RBbmltYXRpb25GcmFtZSgpXG4vLyAgICAgdGltZW91dCA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24oKSB7XG4vLyAgICAgICBmbi5hcHBseShjb250ZXh0LCBhcmdzKTtcbi8vICAgICB9KTtcbi8vICAgfTtcbi8vIH07XG5cbi8vIHRocm90dGxlIGZ1bmN0aW9uIGZyb20gaHR0cDovL3NhbXBzb25ibG9nLmNvbS9zaW1wbGUtdGhyb3R0bGUtZnVuY3Rpb24vXG5mdW5jdGlvbiB0aHJvdHRsZShjYWxsYmFjaywgbGltaXQpIHtcbiAgbGV0IHRpY2sgPSBmYWxzZTtcbiAgcmV0dXJuICgpID0+IHtcbiAgICBpZiAoIXRpY2spIHtcbiAgICAgIGNhbGxiYWNrLmNhbGwoKTtcbiAgICAgIHRpY2sgPSB0cnVlO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRpY2sgPSBmYWxzZTtcbiAgICAgIH0sIGxpbWl0KTtcbiAgICB9XG4gIH07XG59XG5cbi8vIGRlYm91bmNlIGZ1bmN0aW9uIGFwcGxpZWQgdG8gc2Nyb2xsIGV2ZW50XG5jb25zdCBkZXBsb3lTY3JvbGxOYXZUaHJvdHRsZWQgPSB0aHJvdHRsZShkZXBsb3lTY3JvbGxOYXYsIDEyMCk7XG5cbi8vIEVWRU5UUyAvL1xuXG4vLyBob3ZlcnMgb3ZlciBmaXJzdCB0b3AgbmF2IGl0ZW1cbnRvcE5hdlxuICAucXVlcnlTZWxlY3RvcignLnRvcC1uYXZfX2l0ZW06Zmlyc3QtY2hpbGQnKVxuICAuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgZHJvcGRvd24uZGVsaW5lYXRlKTtcbnRvcE5hdlxuICAucXVlcnlTZWxlY3RvcignLnRvcC1uYXZfX2l0ZW06Zmlyc3QtY2hpbGQnKVxuICAuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCBkcm9wZG93bi5kZWxpbmVhdGUpO1xuXG4vLyBmb2N1c2luZyBvdXQgb2YgZHJvcGRvd24gbWVudVxudG9wTmF2TGlzdC5hZGRFdmVudExpc3RlbmVyKCdmb2N1c2luJywgZHJvcGRvd24uZm9jdXNPdXQpO1xuXG4vLyBjbGlja3Mgb24gaGFtYnVyZ2VyIG1lbnVcbmhhbWJ1cmdlck1lbnUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtb2RhbC5kaXNwbGF5TWVudSk7XG5oYW1idXJnZXJNZW51Mi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG1vZGFsLmRpc3BsYXlNZW51KTtcblxuLy8gdXBkYXRlIGFyaWEtZXhwYW5kZWQgb24gZHJvcGRvd24gbWVudVxudG9wTmF2LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZHJvcGRvd24udG9nZ2xlKTtcblxuLy8gY2xpY2tzIG9uIG1hZ25pZnlpbmcgZ2xhc3MgYW5kIHhcbnNlYXJjaGJhci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRvZ2dsZVNlYXJjaEJhcik7XG5cbi8vIGNsaWNrcyBvbiBjaGVja2JveFxubmV3c2xldHRlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHVwZGF0ZUFyaWFDaGVja2JveCk7XG5cbi8vIGNsaWNrcyBvbiB1c2VyIGljb25cbnVzZXJJY29uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgbW9kYWwuZGlzcGxheUZvcm0pO1xuXG4vLyBjbGlja3Mgb24gY2xvc2UgaWNvblxuanNNb2RhbHMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICBpZiAoIWUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnanMtaWNvbi1jbG9zZScpKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIG1vZGFsLmNsb3NlKGUpO1xufSk7XG5cbi8vIGNsb3NlIG1vZGFsIG9uIGVzYyBwcmVzc1xuanNNb2RhbHMuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7XG4gIGlmIChlLmtleSA9PT0gJ0VzY2FwZScpIHtcbiAgICBtb2RhbC5jbG9zZSgpO1xuICB9XG59KTtcblxuLy8gY2xpY2tzIG9uIHRhYi1zd2l0Y2hlc1xudGFiU3dpdGNoZXMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtb2RhbC5zd2l0Y2gpO1xuXG4vLyBtb3VzZSBvdmVyIHJlZWwgYXJ0aWNsZSB0aHVtYm5haWxzXG5yZWVsU3RvcnlOYXYuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgcmVlbFRyYW5zaXRpb24uaG92ZXJJbik7XG5yZWVsU3RvcnlOYXYuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdXQnLCByZWVsVHJhbnNpdGlvbi5ob3Zlck91dCk7XG5cbi8vIHN1Ym1pdHMgb24gS2luamEgZm9ybVxubG9naW4uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgdmFsaWRhdGVGb3JtKTtcblxuLy8gZGVwbG95IG5hdmJhciBpZiBzY3JvbGxlZCB0byB0aGUgZW1haWwgc3Vic2NyaWJlIGlucHV0XG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgZGVwbG95U2Nyb2xsTmF2VGhyb3R0bGVkKTtcblxuLy8gYXV0by1zY3JvbGwgdG8gdG9wIG9mIHBhZ2Ugb24gY2xpY2sgb2YgdXAgYXJyb3dcbnNjcm9sbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNjcm9sbFRvVG9wKTtcblxuLy8gc3RvcCB0aGUgc3VibWlzc2lvbiBvZiBhbGwgZm9ybXNcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIHN0b3BTdWJtaXNzaW9uKTtcblxuLy8gcnVuIGF1dG8gcmVlbCBvbiB3aW5kb3cgbG9hZFxud2luZG93Lm9ubG9hZCA9IHJlZWxUcmFuc2l0aW9uLmF1dG8oKTtcbiJdfQ==
